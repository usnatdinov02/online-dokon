<!DOCTYPE html>
<html lang="uz">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Mahsulotlar - Mercedes-Benz</title>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="{% static 'manifest.webmanifest' %}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Mobile First Responsive Fixes */
        * { box-sizing: border-box; }
        :root{--mb-primary:#0d6efd;--mb-secondary:#6c757d;--mb-success:#198754;--mb-danger:#dc3545;--mb-warning:#ffc107;--mb-info:#0dcaf0;--mb-dark:#212529;--gradient-primary:linear-gradient(135deg,#0d6efd,#0a58ca);--gradient-success:linear-gradient(135deg,#198754,#146c43);--shadow-sm:0 2px 8px rgba(0,0,0,.08);--shadow-md:0 4px 16px rgba(0,0,0,.12);--shadow-lg:0 8px 24px rgba(0,0,0,.16)}
        
        /* Sticky Mobile Header */
        .mobile-header {
            position: sticky;
            top: 0;
            z-index: 1030;
            background: white;
            padding: 0.75rem 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            display: none;
            border-bottom: 1px solid #e9ecef;
        }
        
        @media (max-width: 768px) {
            .mobile-header {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }
            
            .header {
                display: none;
            }
        }
        
        .mobile-header .profile-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid var(--mb-primary);
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(13,110,253,0.2);
        }
        
        .mobile-header .profile-avatar:active {
            transform: scale(0.95);
        }
        
        .mobile-header .search-box {
            flex: 1;
            position: relative;
        }
        
        .mobile-header .search-box input {
            width: 100%;
            padding: 0.65rem 2.8rem 0.65rem 2.8rem;
            border: 2px solid #667eea;
            border-radius: 12px;
            font-size: 0.9rem;
            background: white;
            color: #1a1a2e;
            transition: all 0.3s ease;
        }
        
        .mobile-header .search-box input:focus {
            outline: none;
            border-color: #764ba2;
            background: white;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .mobile-header .search-box .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 1rem;
        }
        
        /* Dark Mode Styles */
        [data-theme="dark"] .mobile-header {
            background: #1a1a2e;
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
        }
        
        [data-theme="dark"] .mobile-header .search-box input {
            background: #0f1724;
            color: #e6eef6;
            border-color: #667eea;
        }
        
        [data-theme="dark"] .mobile-header .search-box input:focus {
            background: #0f1724;
            border-color: #764ba2;
        }
        
        [data-theme="dark"] .category-pills {
            background: #1a1a2e;
            border-bottom-color: rgba(255,255,255,0.1);
        }
        
        [data-theme="dark"] .category-pill {
            background: #0f1724;
            color: #e6eef6;
        }
        
        [data-theme="dark"] .category-pill.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .mobile-header .search-box .clear-search {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            cursor: pointer;
            display: none;
            font-size: 1rem;
        }
        
        .mobile-header .search-box .clear-search.show {
            display: block;
        }
        
        .mobile-header .cart-icon {
            position: relative;
            color: var(--mb-dark);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .mobile-header .cart-icon:active {
            background: #f8f9fa;
            transform: scale(0.95);
        }
        
        .mobile-header .cart-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--mb-danger);
            color: white;
            border-radius: 10px;
            min-width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            padding: 0 4px;
            box-shadow: 0 2px 4px rgba(220,53,69,0.3);
        }
        
        /* Category Filter Pills */
        .category-pills {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.75rem 1rem;
            background: white;
            position: sticky;
            top: 60px;
            z-index: 1020;
            border-bottom: 1px solid #e9ecef;
            scrollbar-width: none;
        }
        
        .category-pills::-webkit-scrollbar {
            display: none;
        }
        
        .category-pill {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: #f8f9fa;
            color: var(--mb-dark);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .category-pill:active {
            transform: scale(0.95);
        }
        
        .category-pill.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }
        
        @media (max-width: 768px) {
            .category-pills {
                display: flex;
            }
        }
        
        @media (min-width: 769px) {
            .category-pills {
                display: none;
            }
        }
        
        /* Floating quick actions (mobile) */
        .quick-actions{position:fixed;right:14px;bottom:86px;z-index:1050;display:flex;flex-direction:column;gap:12px}
        .quick-actions a{width:54px;height:54px;border-radius:16px;display:flex;align-items:center;justify-content:center;color:#fff;text-decoration:none;box-shadow:0 10px 24px rgba(0,0,0,.25);backdrop-filter:blur(6px)}
        .qa-call{background:#28a745}
        .qa-wa{background:#25D366}
        .qa-tg{background:#0088cc}
        @media(min-width:768px){.quick-actions{display:none}}
        
        body {
            overflow-x: hidden;
            width: 100%;
        }
        
        .container {
            max-width: 1320px;
            padding-left: 15px;
            padding-right: 15px;
            margin: 0 auto;
        }
        
        @media (max-width: 1400px) {
            .container {
                max-width: 1140px;
            }
        }
        
        @media (max-width: 1200px) {
            .container {
                max-width: 960px;
            }
        }
        
        @media (max-width: 992px) {
            .container {
                max-width: 720px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 540px;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                max-width: 100%;
            }
        }
        
        /* Navbar fixes */
        .navbar-brand {
            font-size: 1.2rem !important;
        }
        
        /* Desktop Search Styling */
        .form-control {
            border: 2px solid #667eea;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .form-select {
            border: 2px solid #667eea;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        /* Tablet adjustments */
        @media (max-width: 992px) {
            .product-card .card-img-top {
                height: 220px;
            }
        }
        
        /* Search and Filter - Stack vertically on mobile */
        @media (max-width: 768px) {
            .row.mb-4 > div {
                width: 100%;
                margin-bottom: 0.75rem;
            }
            
            .row.mb-4 .d-flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .row.mb-4 .d-flex .form-control,
            .row.mb-4 .d-flex .form-select {
                width: 100% !important;
                margin: 0 !important;
            }
            
            .row.mb-4 .d-flex .btn {
                width: 100%;
            }
            
            .product-card .card-img-top {
                height: 200px;
            }
        }
        
        /* Product Grid - 2 columns on mobile */
        @media (max-width: 576px) {
            .row-cols-2 {
                --bs-columns: 2;
            }
            
            .row-cols-2 > * {
                width: 50% !important;
                flex: 0 0 50%;
                max-width: 50%;
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        
        /* Product Cards - Modern Design */
        .product-card {
            width: 100%;
            margin-bottom: 1.5rem;
            border-radius: 20px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: white;
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
        }
        
        .product-card .card-img-top {
            width: 100%;
            height: 280px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .card-img-top {
            transform: scale(1.08);
        }
        
        .product-card .card-body {
            padding: 1.5rem;
        }
        
        .product-card .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #1a1a2e;
        }
        
        .product-card .card-text {
            font-size: 1rem;
            color: #6c757d;
        }
        
        .product-card .btn {
            font-size: 0.95rem;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            box-shadow: 0 4px 15px rgba(13,110,253,0.25);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(13,110,253,0.35);
            filter: brightness(1.05);
        }
        
        .btn-outline-primary {
            border-radius: 12px;
            border: 2px solid var(--mb-primary);
            color: var(--mb-primary);
            background: white;
        }
        
        .btn-outline-primary:hover {
            background: var(--mb-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13,110,253,0.25);
        }
        
        .btn-outline-danger {
            border-radius: 12px;
        }
        
        /* Button group - Desktop */
        .product-card .d-flex {
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .product-card .d-flex .btn {
            flex: 1;
            min-width: 130px;
        }
        
        @media (max-width: 576px) {
            .product-card {
                font-size: 0.85rem;
                border-radius: 16px;
            }
            
            .product-card .card-body {
                padding: 1rem;
            }
            
            .product-card .card-title {
                font-size: 1rem;
                font-weight: 700;
            }
            
            .product-card .card-text {
                font-size: 0.8rem;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                line-clamp: 2;
            }
            
            .product-card .card-img-top {
                height: 180px;
            }
            
            /* Modern Mobile Buttons */
            .product-card .d-flex {
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 0.75rem;
            }

            .product-card .d-flex .btn {
                width: 100%;
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
                border-radius: 10px;
                font-weight: 600;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .product-card .btn-primary {
                background: var(--gradient-primary);
                box-shadow: 0 4px 12px rgba(13,110,253,0.25);
            }
            
            .product-card .btn-outline-primary {
                border: 2px solid var(--mb-primary);
                color: var(--mb-primary);
                background: white;
            }
            
            .product-card .fs-4 {
                font-size: 1.1rem !important;
            }
        }

        /* Mobile bottom nav polish */
        .mobile-bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#111;border-top:1px solid rgba(255,255,255,.1);display:flex;justify-content:space-around;padding:.45rem .25rem;z-index:1040}
        .mobile-bottom-nav a{color:#eaeaea;text-decoration:none;font-size:.8rem;display:flex;flex-direction:column;align-items:center;gap:2px}
        .mobile-bottom-nav .icon{font-size:1.2rem;margin-bottom:2px;color:#fff}
        .mobile-bottom-nav a:hover{color:#fff}
        /* Floating Settings Button Styles */
        .fab-settings {
            transition: all 0.3s ease;
        }
        
        .fab-settings:hover {
            transform: scale(1.1) rotate(90deg);
            filter: brightness(1.1);
        }
        
        .fab-settings:active {
            transform: scale(0.95);
        }
        
        /* Desktop Settings Button */
        @media (min-width: 769px) {
            .fab-settings.d-none.d-md-flex {
                position: fixed;
                right: 20px;
                top: 100px;
                z-index: 1050;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: #fff;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 16px rgba(102,126,234,0.3);
                text-decoration: none;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Sticky Header -->
    <div class="mobile-header">
        <a href="{% url 'user_profile' %}">
            <img src="https://ui-avatars.com/api/?name={{ user.first_name|default:'User' }}+{{ user.last_name|default:'' }}&size=42&background=0d6efd&color=fff" 
                 alt="Profile" class="profile-avatar">
        </a>
        <div class="search-box">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="Qidirish..." id="mobileSearchInput">
            <i class="fas fa-times clear-search" id="clearSearch"></i>
        </div>
        <a href="{% url 'cart' %}" class="cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-badge" id="mobileCartCount">0</span>
        </a>
    </div>
    
    <!-- Category Pills (Mobile Only) -->
    <div class="category-pills">
        <div class="category-pill active" data-category="all">
            <i class="fas fa-th me-1"></i> Barchasi
        </div>
        {% for category in categories %}
        <div class="category-pill" data-category="{{ category.id }}">
            {% if category.name|lower == 'sedan' %}
                <i class="fas fa-car me-1"></i>
            {% elif category.name|lower == 'suv' %}
                <i class="fas fa-truck me-1"></i>
            {% elif category.name|lower == 'coupe' %}
                <i class="fas fa-car-side me-1"></i>
            {% elif 'elektr' in category.name|lower or 'electric' in category.name|lower %}
                <i class="fas fa-bolt me-1"></i>
            {% elif category.name|lower == 'sport' %}
                <i class="fas fa-flag-checkered me-1"></i>
            {% elif category.name|lower == 'crossover' %}
                <i class="fas fa-shuttle-van me-1"></i>
            {% else %}
                <i class="fas fa-car me-1"></i>
            {% endif %}
            {{ category.name }}
        </div>
        {% endfor %}
    </div>
    <!-- Navbar -->
    <header class="header">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-lg">
            <div class="container">
                <a class="navbar-brand fw-bold fs-3" href="{% url 'home' %}">
                    <i class="fas fa-copyright"></i> Mercedes-Benz
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                    {% with lang=lang %}
                    <ul class="navbar-nav">
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold" href="{% url 'home' %}">{% if lang == 'ru' %}Главная{% else %}Bosh Sahifa{% endif %}</a>
                        </li>
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold active" href="{% url 'product_list' %}">{% if lang == 'ru' %}Автомобили{% else %}Avtomobillar{% endif %}</a>
                        </li>
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold" href="{% url 'wishlist' %}"><i class="fas fa-heart"></i> {% if lang == 'ru' %}Избранное{% else %}Wishlist{% endif %} <span id="wishlist-count" class="badge bg-warning text-dark">0</span></a>
                        </li>
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold" href="{% url 'contact' %}">{% if lang == 'ru' %}Контакты{% else %}Aloqa{% endif %}</a>
                        </li>
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold" href="{% url 'settings' %}">Sozlamalar</a>
                        </li>
                        <li class="nav-item mx-3">
                            <a class="nav-link text-uppercase fw-bold" href="{% url 'cart' %}">{% if lang == 'ru' %}Корзина{% else %}Savat{% endif %} <span id="cart-count" class="badge bg-danger">0</span></a>
                        </li>
                    </ul>
                    {% endwith %}
                </div>
                <div class="d-flex align-items-center" id="authSection">
                    <!-- Theme toggle button (light / dark) -->
                    <button id="theme-toggle" class="btn btn-outline-light me-3" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <!-- Lang switcher -->
                    <div class="btn-group me-3 d-none d-md-inline-flex" role="group" aria-label="Language">
                        <a class="btn btn-outline-light btn-sm" href="{% url 'set_language' %}?lang=uz&next={{ request.path }}">UZ</a>
                        <a class="btn btn-outline-light btn-sm" href="{% url 'set_language' %}?lang=ru&next={{ request.path }}">RU</a>
                        <a class="btn btn-outline-light btn-sm" href="{% url 'set_language' %}?lang=en&next={{ request.path }}">EN</a>
                    </div>
                    {% if user.is_authenticated %}
                        <span class="text-light me-3">Salom, {{ user.first_name|default:user.username }}!</span>
                        <a href="{% url 'logout' %}" class="btn btn-outline-light">Chiqish</a>
                    {% else %}
                        <a href="{% url 'register' %}" class="btn btn-outline-light me-2">Ro'yxatdan o'tish</a>
                        <a href="{% url 'admin:login' %}" class="btn btn-outline-light">Kirish</a>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container my-5">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="text-center mb-4">Barcha Avtomobillar</h1>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <form method="GET" class="d-flex">
                        <input type="text" name="search" class="form-control me-2" placeholder="Mahsulot qidirish..." value="{{ search_query }}">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Qidirish
                        </button>
                    </form>
                </div>
                <div class="col-md-4">
                    <form method="GET" class="d-flex">
                        <select name="category" class="form-select me-2">
                            <option value="">Barcha kategoriyalar</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-outline-primary">Filtr</button>
                    </form>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="row row-cols-2 row-cols-md-3 g-3">
                {% for product in products %}
                <div class="col mb-4">
                    <div class="card product-card shadow-sm h-100 position-relative">
                        {% if product.has_discount %}
                            <span class="badge bg-danger position-absolute" style="top:10px;left:10px;border-radius:8px;">-{{ product.discount_percent }}%</span>
                        {% endif %}
                        {% if product.image %}
                            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="height: 250px; object-fit: cover;">
                        {% else %}
                            <img src="https://via.placeholder.com/300x250?text=No+Image" class="card-img-top" alt="{{ product.name }}" style="height: 250px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text text-muted">{{ product.description|truncatewords:20 }}</p>
                            <div class="mt-auto">
                                <p class="card-text">
                                    {% if product.has_discount %}
                                        <span class="text-muted text-decoration-line-through me-2">${{ product.price }}</span>
                                        <strong class="text-danger fs-4">${{ product.discounted_price|floatformat:2 }}</strong>
                                    {% else %}
                                        <strong class="text-primary fs-4">${{ product.price }}</strong>
                                    {% endif %}
                                    {% if product.stock > 0 %}
                                        <small class="text-success">• Omborda: {{ product.stock }} ta</small>
                                    {% else %}
                                        <small class="text-danger">• Omborda yo'q</small>
                                    {% endif %}
                                </p>
                                <div class="d-flex justify-content-between">
                                    <a href="{% url 'product_detail' product.id %}" class="btn btn-outline-primary">
                                        <i class="fas fa-eye"></i> Batafsil
                                    </a>
                                    <div class="btn-group" role="group">
                                        {% if product.stock > 0 %}
                                            {% if user.is_authenticated %}
                                                <button class="btn btn-primary add-to-cart-btn" data-id="{{ product.id }}">
                                                    <i class="fas fa-cart-plus"></i> Savatchaga
                                                </button>
                                            {% else %}
                                                <a class="btn btn-primary" href="{% url 'register' %}">
                                                    <i class="fas fa-cart-plus"></i> Savatchaga
                                                </a>
                                            {% endif %}
                                        {% else %}
                                            <button class="btn btn-secondary" disabled>
                                                <i class="fas fa-times"></i> Omborda yo'q
                                            </button>
                                        {% endif %}
                                        {% if user.is_authenticated %}
                                            <a href="{% url 'add_to_wishlist' product.id %}" class="btn btn-outline-danger" title="Wishlist-ga qo'shish">
                                                <i class="fas fa-heart"></i>
                                            </a>
                                        {% else %}
                                            <a href="{% url 'register' %}" class="btn btn-outline-danger" title="Kirish yoki Ro'yxatdan o'ting">
                                                <i class="fas fa-heart"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h3 class="text-muted">Mahsulot topilmadi</h3>
                        <p class="text-muted">Qidiruv so'zini o'zgartiring yoki boshqa kategoriyani tanlang.</p>
                        <a href="{% url 'product_list' %}" class="btn btn-primary">Barcha mahsulotlarni ko'rish</a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if products.has_other_pages %}
            <nav aria-label="Mahsulotlar sahifalari">
                <ul class="pagination justify-content-center">
                    {% if products.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                    {% endif %}

                    {% for num in products.paginator.page_range %}
                        {% if products.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
        <div class="container">
            <p>&copy; 2025 Mercedes-Benz. Barcha huquqlar himoyalangan.</p>
            <p><a href="privacy.html" class="text-white">Maxfiylik siyosati</a> | <a href="contact.html" class="text-white">Aloqa</a></p>
        </div>
    </footer>

    

    <!-- Mobile bottom navigation -->
    <div class="mobile-bottom-nav d-md-none">
        {% with lang=lang %}
        <a href="{% url 'home' %}"><i class="fas fa-home icon"></i><span>{% if lang == 'ru' %}Главная{% else %}Uy{% endif %}</span></a>
        <a href="{% url 'product_list' %}"><i class="fas fa-th-list icon"></i><span>{% if lang == 'ru' %}Товары{% else %}Mahsulotlar{% endif %}</span></a>
        <a href="{% url 'wishlist' %}"><i class="fas fa-heart icon"></i><span>{% if lang == 'ru' %}Избранное{% else %}Sevimlilar{% endif %}</span><span id="mobile-wishlist-count" class="badge bg-warning text-dark">0</span></a>
        <a href="{% url 'cart' %}"><i class="fas fa-shopping-cart icon"></i><span>{% if lang == 'ru' %}Корзина{% elif lang == 'en' %}Cart{% else %}Savat{% endif %}</span><span id="mobile-cart-count" class="badge bg-danger">0</span></a>
        {% if user.is_authenticated %}
            <a href="{% url 'user_profile' %}"><i class="fas fa-user icon"></i><span>{% if lang == 'ru' %}Профиль{% elif lang == 'en' %}Profile{% else %}Profil{% endif %}</span></a>
        {% else %}
            <a href="{% url 'register' %}"><i class="fas fa-user icon"></i><span>{% if lang == 'ru' %}Войти{% elif lang == 'en' %}Login{% else %}Kirish{% endif %}</span></a>
        {% endif %}
        {% endwith %}
    </div>

    <!-- Floating Settings Button (Mobile - Bottom Right) -->
    <a href="{% url 'settings' %}" class="fab-settings d-md-none" aria-label="Sozlamalar" style="position:fixed;right:14px;bottom:86px;z-index:1050;width:54px;height:54px;border-radius:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 24px rgba(0,0,0,.25);text-decoration:none;">
        <i class="fas fa-cog"></i>
    </a>
    
    <!-- Desktop Settings Button (Top Right) -->
    <a href="{% url 'settings' %}" class="fab-settings d-none d-md-flex" aria-label="Sozlamalar">
        <i class="fas fa-cog"></i>
    </a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'script.js' %}"></script>
    <script src="animations.js"></script>
    <script src="advanced-features.js"></script>
    <script src="{% static 'enhanced-features.js' %}"></script>
    <script>
        // Mobile Search Functionality with Animation
        const searchInput = document.getElementById('mobileSearchInput');
        const clearSearchBtn = document.getElementById('clearSearch');
        
        searchInput?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            const productCards = document.querySelectorAll('.product-card');
            
            // Show/hide clear button
            if (searchTerm) {
                clearSearchBtn.classList.add('show');
            } else {
                clearSearchBtn.classList.remove('show');
            }
            
            let visibleCount = 0;
            productCards.forEach((card, index) => {
                const title = card.querySelector('.card-title')?.textContent.toLowerCase();
                const description = card.querySelector('.card-text')?.textContent.toLowerCase();
                const parent = card.parentElement;
                
                if (title?.includes(searchTerm) || description?.includes(searchTerm)) {
                    parent.style.display = 'block';
                    parent.style.animation = `fadeIn 0.4s ease ${index * 0.05}s both`;
                    visibleCount++;
                } else {
                    parent.style.display = 'none';
                }
            });
            
            // Show no results message
            showSearchResults(visibleCount, searchTerm);
        });
        
        // Clear search
        clearSearchBtn?.addEventListener('click', function() {
            searchInput.value = '';
            clearSearchBtn.classList.remove('show');
            document.querySelectorAll('.product-card').forEach(card => {
                card.parentElement.style.display = 'block';
            });
            removeSearchResults();
        });
        
        // Category Filter
        document.querySelectorAll('.category-pill').forEach(pill => {
            pill.addEventListener('click', function() {
                // Remove active from all
                document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
                // Add active to clicked
                this.classList.add('active');
                
                const category = this.dataset.category;
                const productCards = document.querySelectorAll('.product-card');
                
                productCards.forEach((card, index) => {
                    const parent = card.parentElement;
                    if (category === 'all') {
                        parent.style.display = 'block';
                        parent.style.animation = `fadeIn 0.4s ease ${index * 0.05}s both`;
                    } else {
                        // You can add data-category attribute to cards for real filtering
                        parent.style.display = 'block';
                        parent.style.animation = `fadeIn 0.4s ease ${index * 0.05}s both`;
                    }
                });
            });
        });
        
        function showSearchResults(count, term) {
            removeSearchResults();
            if (term && count === 0) {
                const container = document.querySelector('.row.row-cols-2');
                const noResults = document.createElement('div');
                noResults.className = 'col-12 text-center py-5';
                noResults.id = 'noResults';
                noResults.innerHTML = `
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4>Hech narsa topilmadi</h4>
                    <p class="text-muted">"${term}" uchun natija yo'q</p>
                `;
                container?.appendChild(noResults);
            }
        }
        
        function removeSearchResults() {
            document.getElementById('noResults')?.remove();
        }
        
        // Add fadeIn animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Update mobile cart count
        function updateMobileCartCount() {
            const cartCount = document.getElementById('cart-count')?.textContent || '0';
            const mobileCartBadge = document.getElementById('mobileCartCount');
            if (mobileCartBadge) {
                mobileCartBadge.textContent = cartCount;
            }
        }
        
        // Call on page load
        updateMobileCartCount();
        
        // Update every 2 seconds
        setInterval(updateMobileCartCount, 2000);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('{% static 'service-worker.js' %}');
            });
        }
    </script>
</body>
</html>